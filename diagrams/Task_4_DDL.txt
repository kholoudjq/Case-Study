CREATE SCHEMA raw;
CREATE SCHEMA staging;
CREATE SCHEMA dwh;
CREATE SCHEMA marts;


CREATE TABLE raw.orders_raw (
    row_id          INTEGER,
    order_id        VARCHAR(50),
    order_date      VARCHAR(50),
    ship_date       VARCHAR(50),
    ship_mode       VARCHAR(50),
    customer_id     VARCHAR(50),
    customer_name   VARCHAR(255),
    segment         VARCHAR(50),
    country         VARCHAR(50),
    city            VARCHAR(100),
    state           VARCHAR(100),
    postal_code     VARCHAR(50),
    region          VARCHAR(50),
    product_id      VARCHAR(50),
    category        VARCHAR(50),
    sub_category    VARCHAR(50),
    product_name    VARCHAR(255),
    sales           VARCHAR(50),
    quantity        VARCHAR(50),
    discount        VARCHAR(50),
    profit          VARCHAR(50),
    source_filename VARCHAR(255),
    load_timestamp  TIMESTAMP
);


CREATE TABLE staging.orders_stg (
    row_id          INTEGER,
    order_id        VARCHAR(50),
    order_date      DATE,
    ship_date       DATE,
    customer_id     VARCHAR(50),
    product_id      VARCHAR(50),
    quantity        INTEGER,
    sales           NUMERIC(12,2),
    discount        NUMERIC(5,2),
    profit          NUMERIC(12,2),
    geography_key   VARCHAR(255),  
    source_filename VARCHAR(255),
    load_timestamp  TIMESTAMP
);


CREATE TABLE dwh.dim_customer (
    customer_key   SERIAL PRIMARY KEY,
    customer_id    VARCHAR(50) UNIQUE,
    customer_name  VARCHAR(255),
    segment        VARCHAR(50)
);


CREATE TABLE dwh.dim_product (
    product_key    SERIAL PRIMARY KEY,
    product_id     VARCHAR(50) UNIQUE,
    category       VARCHAR(50),
    sub_category   VARCHAR(50),
    product_name   VARCHAR(255)
);


CREATE TABLE dwh.dim_geography (
    geography_key  SERIAL PRIMARY KEY,
    country        VARCHAR(50),
    state          VARCHAR(100),
    city           VARCHAR(100),
    postal_code    VARCHAR(50),
    region         VARCHAR(50)
);


CREATE TABLE dwh.fact_orders (
    order_key        SERIAL PRIMARY KEY,
    row_id           INTEGER,
    order_id         VARCHAR(50),
    order_date       DATE,
    ship_date        DATE,
    customer_key     INTEGER REFERENCES dwh.dim_customer(customer_key),
    product_key      INTEGER REFERENCES dwh.dim_product(product_key),
    geography_key    INTEGER REFERENCES dwh.dim_geography(geography_key),
    sales            NUMERIC(12,2),
    quantity         INTEGER,
    discount         NUMERIC(5,2),
    profit           NUMERIC(12,2),
    load_timestamp   TIMESTAMP
);


CREATE TABLE marts.sales_by_state (
    state         VARCHAR(100),
    month         DATE,
    total_sales   NUMERIC(12,2),
    total_orders  INTEGER
);

